<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PokéDex - APIs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <style>
        .pokemon-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            height: 100%;
        }
        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .pokemon-image {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin: 0 auto;
            display: block;
        }
        .tipo-badge {
            display: inline-block;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: bold;
            color: white;
        }
        .tipo-normal { background-color: #A8A878; }
        .tipo-fire { background-color: #F08030; }
        .tipo-water { background-color: #6890F0; }
        .tipo-electric { background-color: #F8D030; }
        .tipo-grass { background-color: #78C850; }
        .tipo-ice { background-color: #98D8D8; }
        .tipo-fighting { background-color: #C03028; }
        .tipo-poison { background-color: #A040A0; }
        .tipo-ground { background-color: #E0C068; }
        .tipo-flying { background-color: #A890F0; }
        .tipo-psychic { background-color: #F85888; }
        .tipo-bug { background-color: #A8B820; }
        .tipo-rock { background-color: #B8A038; }
        .tipo-ghost { background-color: #705898; }
        .tipo-dragon { background-color: #7038F8; }
        .tipo-dark { background-color: #705848; }
        .tipo-steel { background-color: #B8B8D0; }
        .tipo-fairy { background-color: #EE99AC; }
        .spinner-container {
            text-align: center;
            padding: 40px;
        }
        .modal-pokemon-image {
            width: 200px;
            height: 200px;
            object-fit: contain;
            margin: 0 auto;
            display: block;
        }
        .habilidad-item, .movimiento-item {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background-color: #f0f0f0;
            border-radius: 5px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container my-4">
        <h1 class="text-center mb-4">PokéDex</h1>
        
        <div id="spinner-container" class="spinner-container" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2">Cargando pokémon...</p>
        </div>

        <div id="pokemon-grid" class="row g-4">
            <!-- Los pokémon se cargarán aquí -->
        </div>

        <div class="text-center mt-4 mb-4">
            <button id="btn-cargar-mas" class="btn btn-primary btn-lg" onclick="cargarMasPokemon()" style="display: none;">
                Cargar Más Pokémon
            </button>
        </div>
    </div>

    <!-- Modal para información detallada -->
    <div class="modal fade" id="modalPokemon" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalPokemonTitle">Pokémon</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <img id="modalPokemonImage" class="modal-pokemon-image" src="" alt="">
                    </div>
                    <div id="modalPokemonContent">
                        <!-- Contenido dinámico -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script type="text/javascript">
        let pokemonCargados = 0;
        const limiteInicial = 151;
        const limiteMaximo = 1000; // Límite de la API
        let todosLosPokemon = [];

        /**
         * mostrarSpinner()
         * Muestra u oculta el spinner de carga
         */
        function mostrarSpinner(mostrar) {
            document.getElementById('spinner-container').style.display = mostrar ? 'block' : 'none';
        }

        /**
         * obtenerColorTipo()
         * Retorna la clase CSS para el color del tipo
         */
        function obtenerColorTipo(tipo) {
            return `tipo-${tipo}`;
        }

        /**
         * formatearNombre()
         * Capitaliza la primera letra del nombre
         */
        function formatearNombre(nombre) {
            return nombre.charAt(0).toUpperCase() + nombre.slice(1);
        }

        /**
         * crearCartaPokemon()
         * Crea el HTML de una carta de pokémon
         */
        function crearCartaPokemon(pokemon) {
            const tipos = pokemon.types.map(t => t.type.name);
            const tiposHTML = tipos.map(tipo => 
                `<span class="tipo-badge ${obtenerColorTipo(tipo)}">${formatearNombre(tipo)}</span>`
            ).join('');

            return `
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="card pokemon-card" onclick="mostrarDetallesPokemon(${pokemon.id})">
                        <div class="card-body text-center">
                            <img src="${pokemon.sprites.front_default || pokemon.sprites.other['official-artwork'].front_default}" 
                                 class="pokemon-image" 
                                 alt="${formatearNombre(pokemon.name)}">
                            <h5 class="card-title mt-2">${formatearNombre(pokemon.name)}</h5>
                            <p class="card-text">#${pokemon.id.toString().padStart(3, '0')}</p>
                            <div class="mb-2">
                                ${tiposHTML}
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); mostrarDetallesPokemon(${pokemon.id})">
                                Ver Detalles
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * cargarPokemon()
         * Carga los datos de un pokémon desde la API
         */
        async function cargarPokemon(id) {
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
                if (!response.ok) throw new Error('Error al cargar pokémon');
                return await response.json();
            } catch (error) {
                console.error('Error:', error);
                return null;
            }
        }

        /**
         * cargarListaPokemon()
         * Carga una lista de pokémon
         */
        async function cargarListaPokemon(limite) {
            mostrarSpinner(true);
            const grid = document.getElementById('pokemon-grid');
            
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon?limit=${limite}`);
                const data = await response.json();
                todosLosPokemon = data.results;
                
                // Cargar detalles de cada pokémon
                const promesas = todosLosPokemon.map((pokemon, index) => 
                    cargarPokemon(index + 1)
                );
                
                const pokemonData = await Promise.all(promesas);
                const pokemonValidos = pokemonData.filter(p => p !== null);
                
                grid.innerHTML = pokemonValidos.map(p => crearCartaPokemon(p)).join('');
                
                pokemonCargados = pokemonValidos.length;
                
                // Mostrar botón de cargar más si hay más pokémon disponibles
                if (pokemonCargados < limiteMaximo) {
                    document.getElementById('btn-cargar-mas').style.display = 'block';
                } else {
                    document.getElementById('btn-cargar-mas').style.display = 'none';
                }
                
            } catch (error) {
                console.error('Error al cargar pokémon:', error);
                grid.innerHTML = '<div class="col-12"><div class="alert alert-danger">Error al cargar los pokémon. Por favor, recarga la página.</div></div>';
            } finally {
                mostrarSpinner(false);
            }
        }

        /**
         * cargarMasPokemon()
         * Carga más pokémon adicionales
         */
        async function cargarMasPokemon() {
            const nuevoLimite = Math.min(pokemonCargados + 50, limiteMaximo);
            mostrarSpinner(true);
            const grid = document.getElementById('pokemon-grid');
            
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon?limit=${nuevoLimite}`);
                const data = await response.json();
                
                // Solo cargar los nuevos pokémon
                const nuevosPokemon = data.results.slice(pokemonCargados);
                const promesas = nuevosPokemon.map((pokemon, index) => 
                    cargarPokemon(pokemonCargados + index + 1)
                );
                
                const pokemonData = await Promise.all(promesas);
                const pokemonValidos = pokemonData.filter(p => p !== null);
                
                // Agregar las nuevas cartas
                grid.innerHTML += pokemonValidos.map(p => crearCartaPokemon(p)).join('');
                
                pokemonCargados += pokemonValidos.length;
                
                // Ocultar botón si llegamos al límite
                if (pokemonCargados >= limiteMaximo) {
                    document.getElementById('btn-cargar-mas').style.display = 'none';
                }
                
            } catch (error) {
                console.error('Error al cargar más pokémon:', error);
                alert('Error al cargar más pokémon. Por favor, intenta de nuevo.');
            } finally {
                mostrarSpinner(false);
            }
        }

        /**
         * mostrarDetallesPokemon()
         * Muestra los detalles de un pokémon en un modal
         */
        async function mostrarDetallesPokemon(id) {
            mostrarSpinner(true);
            const modal = new bootstrap.Modal(document.getElementById('modalPokemon'));
            
            try {
                const pokemon = await cargarPokemon(id);
                if (!pokemon) {
                    alert('Error al cargar los detalles del pokémon');
                    mostrarSpinner(false);
                    return;
                }
                
                // Configurar título
                document.getElementById('modalPokemonTitle').textContent = formatearNombre(pokemon.name);
                
                // Configurar imagen
                const imagen = pokemon.sprites.other['official-artwork'].front_default || 
                              pokemon.sprites.front_default;
                document.getElementById('modalPokemonImage').src = imagen;
                
                // Tipos
                const tipos = pokemon.types.map(t => t.type.name);
                const tiposHTML = tipos.map(tipo => 
                    `<span class="tipo-badge ${obtenerColorTipo(tipo)}">${formatearNombre(tipo)}</span>`
                ).join('');
                
                // Habilidades (al menos una)
                const habilidades = pokemon.abilities.slice(0, Math.max(1, pokemon.abilities.length));
                const habilidadesHTML = habilidades.map(hab => 
                    `<span class="habilidad-item">${formatearNombre(hab.ability.name)}</span>`
                ).join('');
                
                // Movimientos (al menos cuatro)
                const movimientos = pokemon.moves.slice(0, Math.max(4, pokemon.moves.length));
                const movimientosHTML = movimientos.map(mov => 
                    `<span class="movimiento-item">${formatearNombre(mov.move.name)}</span>`
                ).join('');
                
                // Altura y peso
                const altura = (pokemon.height / 10).toFixed(1); // Convertir a metros
                const peso = (pokemon.weight / 10).toFixed(1); // Convertir a kg
                
                // Contenido del modal
                const contenido = `
                    <div class="mb-3">
                        <strong>Número:</strong> #${pokemon.id.toString().padStart(3, '0')}
                    </div>
                    <div class="mb-3">
                        <strong>Tipos:</strong><br>
                        ${tiposHTML}
                    </div>
                    <div class="mb-3">
                        <strong>Altura:</strong> ${altura} m<br>
                        <strong>Peso:</strong> ${peso} kg
                    </div>
                    <div class="mb-3">
                        <strong>Habilidades:</strong><br>
                        ${habilidadesHTML}
                    </div>
                    <div class="mb-3">
                        <strong>Movimientos:</strong><br>
                        ${movimientosHTML}
                    </div>
                `;
                
                document.getElementById('modalPokemonContent').innerHTML = contenido;
                modal.show();
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del pokémon');
            } finally {
                mostrarSpinner(false);
            }
        }

        // Cargar los primeros 151 pokémon al iniciar
        cargarListaPokemon(limiteInicial);
    </script>
</body>
</html>

