<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Contactos - DOM y JavaScript</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <style>
        .contacto-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            transition: background-color 0.2s;
        }
        .contacto-item:hover {
            background-color: #f0f0f0;
        }
        .contacto-item.favorito {
            background-color: #fff3cd;
            border-color: #ffc107;
        }
        .contacto-item.seleccionado {
            background-color: #cfe2ff;
            border-color: #0d6efd;
        }
        .contacto-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .contacto-datos {
            flex: 1;
        }
        .contacto-nombre {
            font-weight: bold;
            font-size: 1.1em;
        }
        .contacto-telefono {
            color: #666;
            font-size: 0.9em;
        }
        .favorito-icon {
            color: #ffc107;
            font-size: 1.5em;
            cursor: pointer;
        }
        .favorito-icon:hover {
            color: #ffb300;
        }
        .checkbox-seleccion {
            margin-right: 10px;
        }
        .acciones-contacto {
            display: flex;
            gap: 5px;
        }
        .buscador {
            margin-bottom: 20px;
        }
        #lista-contactos {
            list-style: none;
            padding: 0;
        }
        .sin-contactos {
            text-align: center;
            padding: 40px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container my-1 my-sm-2 my-md-4 my-lg-5">
        <h1>Lista de Contactos</h1>
        <div class="card">
            <div class="card-body">
                <h2>Contactos</h2>
                
                <!-- Buscador -->
                <div class="buscador">
                    <input type="text" id="buscador" class="form-control" placeholder="Buscar por nombre, apellido o teléfono...">
                </div>
                
                <!-- Opciones de ordenamiento y filtros -->
                <div class="mb-3">
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <label for="ordenar-por" class="form-label">Ordenar por:</label>
                            <select id="ordenar-por" class="form-select">
                                <option value="apellido">Apellido</option>
                                <option value="nombre">Nombre</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-2">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="solo-favoritos">
                                <label class="form-check-label" for="solo-favoritos">
                                    Solo favoritos
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4 mb-2">
                            <button id="btn-eliminar-seleccionados" class="btn btn-danger mt-4 w-100" style="display: none;">
                                Eliminar Seleccionados
                            </button>
                        </div>
                    </div>
                </div>
                
                <ul id="lista-contactos"></ul>
                
                <hr class="hr">
                
                <h2>Nuevo Contacto</h2>
                <form id="form-producto">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" name="nombre" id="input-nombre" placeholder="Nombre" aria-label="Nombre" required>
                        <input type="text" class="form-control" name="apellido" id="input-apellido" placeholder="Apellido" aria-label="Apellido" required>
                        <input type="text" class="form-control" name="telefono" id="input-telefono" placeholder="Teléfono" aria-label="Teléfono">
                    </div>
                    <button class="btn btn-primary" type="submit">Agregar Contacto</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script type="text/javascript">
        let contactos = [
            {
                nombre: 'Juan',
                apellido: 'Perez',
                telefono: '',
                favorito: false,
                id: Date.now()
            },
        ];

        let criterioOrden = 'apellido';
        let soloFavoritos = false;
        let terminoBusqueda = '';
        let contactosSeleccionados = new Set();

        /**
         * agregarContacto()
         * esta función se va a llamar cuando el usuario envía el formulario con el nuevo contacto para agregar.
         */
        function agregarContacto(nombre, apellido, telefono) {
            if (nombre.trim() === '' || apellido.trim() === '') {
                return;
            }
            
            const nuevoContacto = {
                nombre: nombre.trim(),
                apellido: apellido.trim(),
                telefono: telefono.trim(),
                favorito: false,
                id: Date.now()
            };
            
            contactos.push(nuevoContacto);
            ordenarContactos();
            mostrarListado();
        }

        /**
         * mostrarListado()
         * esta función se encarga de mostrar en el DOM la lista de todos los contactos guardados en la variable global contactos.
         */
        function mostrarListado() {
            const listaElement = document.getElementById('lista-contactos');
            listaElement.innerHTML = '';

            // Filtrar contactos
            let contactosFiltrados = contactos;
            
            // Filtrar por favoritos
            if (soloFavoritos) {
                contactosFiltrados = contactosFiltrados.filter(c => c.favorito);
            }
            
            // Filtrar por búsqueda
            if (terminoBusqueda.trim() !== '') {
                const busqueda = terminoBusqueda.toLowerCase();
                contactosFiltrados = contactosFiltrados.filter(c => 
                    c.nombre.toLowerCase().includes(busqueda) ||
                    c.apellido.toLowerCase().includes(busqueda) ||
                    c.telefono.includes(busqueda)
                );
            }

            if (contactosFiltrados.length === 0) {
                listaElement.innerHTML = '<li class="sin-contactos">No hay contactos para mostrar</li>';
                return;
            }

            contactosFiltrados.forEach(contacto => {
                const li = document.createElement('li');
                li.className = 'contacto-item' + (contacto.favorito ? ' favorito' : '');
                if (contactosSeleccionados.has(contacto.id)) {
                    li.classList.add('seleccionado');
                }

                // Checkbox para selección múltiple
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'checkbox-seleccion';
                checkbox.checked = contactosSeleccionados.has(contacto.id);
                checkbox.addEventListener('change', () => {
                    toggleSeleccion(contacto.id);
                });

                // Información del contacto
                const infoDiv = document.createElement('div');
                infoDiv.className = 'contacto-info';

                const datosDiv = document.createElement('div');
                datosDiv.className = 'contacto-datos';
                
                const nombreDiv = document.createElement('div');
                nombreDiv.className = 'contacto-nombre';
                nombreDiv.textContent = `${contacto.nombre} ${contacto.apellido}`;
                nombreDiv.addEventListener('dblclick', () => {
                    editarContacto(contacto.id);
                });

                const telefonoDiv = document.createElement('div');
                telefonoDiv.className = 'contacto-telefono';
                telefonoDiv.textContent = contacto.telefono || 'Sin teléfono';
                telefonoDiv.addEventListener('dblclick', () => {
                    editarContacto(contacto.id);
                });

                datosDiv.appendChild(nombreDiv);
                datosDiv.appendChild(telefonoDiv);

                // Icono de favorito
                const favoritoIcon = document.createElement('span');
                favoritoIcon.className = 'favorito-icon';
                favoritoIcon.textContent = contacto.favorito ? '★' : '☆';
                favoritoIcon.addEventListener('click', () => {
                    toggleFavorito(contacto.id);
                });

                // Botones de acción
                const accionesDiv = document.createElement('div');
                accionesDiv.className = 'acciones-contacto';

                const btnEditar = document.createElement('button');
                btnEditar.className = 'btn btn-sm btn-warning';
                btnEditar.textContent = 'Editar';
                btnEditar.addEventListener('click', () => {
                    editarContacto(contacto.id);
                });

                const btnEliminar = document.createElement('button');
                btnEliminar.className = 'btn btn-sm btn-danger';
                btnEliminar.textContent = 'Eliminar';
                btnEliminar.addEventListener('click', () => {
                    eliminarContacto(contacto.id);
                });

                accionesDiv.appendChild(btnEditar);
                accionesDiv.appendChild(btnEliminar);

                infoDiv.appendChild(checkbox);
                infoDiv.appendChild(datosDiv);
                infoDiv.appendChild(favoritoIcon);

                li.appendChild(infoDiv);
                li.appendChild(accionesDiv);
                listaElement.appendChild(li);
            });

            // Mostrar/ocultar botón de eliminar seleccionados
            const btnEliminarSeleccionados = document.getElementById('btn-eliminar-seleccionados');
            if (contactosSeleccionados.size > 0) {
                btnEliminarSeleccionados.style.display = 'block';
                btnEliminarSeleccionados.textContent = `Eliminar Seleccionados (${contactosSeleccionados.size})`;
            } else {
                btnEliminarSeleccionados.style.display = 'none';
            }
        }

        /**
         * ordenarContactos()
         * Ordena los contactos según el criterio seleccionado
         */
        function ordenarContactos() {
            contactos.sort((a, b) => {
                const valorA = a[criterioOrden].toLowerCase();
                const valorB = b[criterioOrden].toLowerCase();
                return valorA.localeCompare(valorB);
            });
        }

        /**
         * toggleFavorito()
         * Marca/desmarca un contacto como favorito
         */
        function toggleFavorito(id) {
            const contacto = contactos.find(c => c.id === id);
            if (contacto) {
                contacto.favorito = !contacto.favorito;
                mostrarListado();
            }
        }

        /**
         * eliminarContacto()
         * Elimina un contacto de la lista
         */
        function eliminarContacto(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este contacto?')) {
                contactos = contactos.filter(c => c.id !== id);
                contactosSeleccionados.delete(id);
                mostrarListado();
            }
        }

        /**
         * toggleSeleccion()
         * Selecciona/deselecciona un contacto para eliminación múltiple
         */
        function toggleSeleccion(id) {
            if (contactosSeleccionados.has(id)) {
                contactosSeleccionados.delete(id);
            } else {
                contactosSeleccionados.add(id);
            }
            mostrarListado();
        }

        /**
         * eliminarSeleccionados()
         * Elimina todos los contactos seleccionados
         */
        function eliminarSeleccionados() {
            if (contactosSeleccionados.size === 0) {
                return;
            }
            
            if (confirm(`¿Estás seguro de que quieres eliminar ${contactosSeleccionados.size} contacto(s)?`)) {
                contactos = contactos.filter(c => !contactosSeleccionados.has(c.id));
                contactosSeleccionados.clear();
                mostrarListado();
            }
        }

        /**
         * editarContacto()
         * Permite editar los datos de un contacto
         */
        function editarContacto(id) {
            const contacto = contactos.find(c => c.id === id);
            if (!contacto) return;

            const nuevoNombre = prompt('Nombre:', contacto.nombre);
            if (nuevoNombre === null) return;

            const nuevoApellido = prompt('Apellido:', contacto.apellido);
            if (nuevoApellido === null) return;

            const nuevoTelefono = prompt('Teléfono:', contacto.telefono);
            if (nuevoTelefono === null) return;

            if (nuevoNombre.trim() !== '' && nuevoApellido.trim() !== '') {
                contacto.nombre = nuevoNombre.trim();
                contacto.apellido = nuevoApellido.trim();
                contacto.telefono = nuevoTelefono.trim();
                ordenarContactos();
                mostrarListado();
            }
        }

        function handlerFormulario(e) {
            e.preventDefault();
            const inputNombre = e.target.querySelector('#input-nombre');
            const inputApellido = e.target.querySelector('#input-apellido');
            const inputTelefono = e.target.querySelector('#input-telefono');
            const nombre = inputNombre.value;
            const apellido = inputApellido.value;
            const telefono = inputTelefono.value;
            inputNombre.value = "";
            inputApellido.value = "";
            inputTelefono.value = "";
            agregarContacto(nombre, apellido, telefono);
        }

        // Event listeners
        document.querySelector('form').addEventListener('submit', handlerFormulario);
        
        document.getElementById('ordenar-por').addEventListener('change', (e) => {
            criterioOrden = e.target.value;
            ordenarContactos();
            mostrarListado();
        });

        document.getElementById('solo-favoritos').addEventListener('change', (e) => {
            soloFavoritos = e.target.checked;
            mostrarListado();
        });

        document.getElementById('buscador').addEventListener('input', (e) => {
            terminoBusqueda = e.target.value;
            mostrarListado();
        });

        document.getElementById('btn-eliminar-seleccionados').addEventListener('click', eliminarSeleccionados);

        // Inicializar
        ordenarContactos();
        mostrarListado();
    </script>
</body>
</html>

